# 智谱AI GLM集成指南

## 📖 概述

本项目现已支持智谱AI的GLM系列模型作为AI服务提供商，为国内用户提供更便捷、高性价比的选择。

## ✨ 特性

- ✅ **完全兼容**: 使用OpenAI兼容接口，无需额外依赖
- ✅ **自动支持**: 所有AI功能（主题生成、脚本生成）自动支持GLM
- ✅ **多模型选择**: 支持glm-4全系列模型
- ✅ **国内优化**: 更快的访问速度，无需科学上网

## 🚀 快速开始

### 步骤1：获取API密钥

1. 访问智谱AI开放平台: https://open.bigmodel.cn/
2. 注册账号（支持手机号注册）
3. 在控制台创建API密钥
4. 复制生成的API Key（格式类似：`xxx.yyy`）

### 步骤2：配置GLM

编辑 `config/settings.json`：

```json
{
  "ai": {
    "provider": "glm",
    "model": "glm-4",
    "api_key": "你的GLM_API密钥",
    "base_url": "https://open.bigmodel.cn/api/paas/v4/",
    "temperature": 0.7,
    "max_tokens": 2000
  }
}
```

### 步骤3：测试配置

运行测试脚本验证配置：

```bash
python3 test_glm_integration.py
```

或直接运行主程序：

```bash
python3 main.py
```

选择菜单1（生成主题）测试API连接。

## 📊 可用模型

智谱AI提供多种GLM模型供选择：

| 模型 | 特点 | 适用场景 | 成本 |
|------|------|---------|------|
| `glm-4` | 通用模型 | 推荐用于脚本生成 | 标准 |
| `glm-4-plus` | 增强版 | 需要更高质量输出 | 较高 |
| `glm-4-air` | 快速版 | 快速迭代、成本控制 | 较低 |
| `glm-4-flash` | 超快速版 | 简单任务、原型测试 | 最低 |

**推荐配置：**
- 生产环境：`glm-4` 或 `glm-4-plus`
- 测试开发：`glm-4-air` 或 `glm-4-flash`

## 💡 使用示例

### 示例1：生成视频主题

```bash
python3 main.py
# 选择菜单1：生成主题
# GLM将自动生成10个科普视频主题建议
```

### 示例2：生成视频脚本

```bash
python3 main.py
# 选择菜单7：生成脚本
# 输入主题，GLM将生成完整的视频脚本
```

### 示例3：完整工作流

```bash
python3 main.py
# 选择菜单13：完整AI工作流
# 从主题生成到成品视频，全程使用GLM
```

## ⚙️ 高级配置

### 调整温度参数

控制输出的创造性（0.0-1.0）：

```json
{
  "ai": {
    "temperature": 0.7  // 默认值，平衡创造性和稳定性
  }
}
```

- `0.0-0.3`: 更确定性，适合事实性内容
- `0.4-0.7`: 平衡（推荐）
- `0.8-1.0`: 更有创造性，适合创意内容

### 调整最大Token数

控制输出长度：

```json
{
  "ai": {
    "max_tokens": 2000  // 默认值
  }
}
```

- 短文本（主题）: 500-1000
- 中等文本（脚本段落）: 1000-2000
- 长文本（完整脚本）: 2000-4000

## 🔄 从OpenAI迁移到GLM

如果你之前使用OpenAI，只需修改3个配置项：

```json
// 之前（OpenAI）
{
  "ai": {
    "provider": "openai",
    "model": "gpt-4",
    "api_key": "sk-xxx",
    "base_url": "https://api.openai.com/v1"
  }
}

// 现在（GLM）
{
  "ai": {
    "provider": "glm",           // 改为glm
    "model": "glm-4",             // 改为GLM模型
    "api_key": "你的GLM密钥",      // 改为GLM API Key
    "base_url": "https://open.bigmodel.cn/api/paas/v4/"  // 改为GLM地址
  }
}
```

其他代码**无需修改**，所有功能自动支持！

## 🔍 故障排查

### 问题1：401 Unauthorized

**原因**: API密钥无效或配置错误

**解决**:
- 检查`api_key`是否正确复制（包含完整的`xxx.yyy`格式）
- 确认API密钥未过期
- 检查`base_url`是否为：`https://open.bigmodel.cn/api/paas/v4/`

### 问题2：网络连接超时

**原因**: 网络问题或GLM服务不可用

**解决**:
- 检查网络连接
- 尝试访问 https://open.bigmodel.cn/ 确认服务可用
- 系统会自动重试3次，请耐心等待

### 问题3：GLM API调用失败

**原因**: 模型不存在或账户额度不足

**解决**:
- 确认使用的模型名称正确（见可用模型表）
- 登录智谱AI控制台检查账户额度
- 尝试使用`glm-4-air`（成本更低）

## 📈 成本对比

智谱AI GLM相比OpenAI的成本优势：

| 任务 | OpenAI GPT-4 | GLM-4 | GLM-4-Air |
|------|-------------|-------|-----------|
| 生成10个主题 | ~$0.10 | ~¥0.30 | ~¥0.15 |
| 生成1个脚本 | ~$0.20 | ~¥0.60 | ~¥0.30 |
| 完整视频工作流 | ~$0.50 | ~¥1.50 | ~¥0.80 |

*注：具体费用以智谱AI官方定价为准，仅供参考*

## 🎯 最佳实践

1. **开发测试**: 使用`glm-4-air`或`glm-4-flash`降低成本
2. **生产使用**: 使用`glm-4`或`glm-4-plus`保证质量
3. **温度设置**: 脚本生成建议0.7，主题生成可用0.8
4. **错误处理**: 系统内置重试机制，无需额外处理

## 📚 参考资源

- **智谱AI官网**: https://open.bigmodel.cn/
- **API文档**: https://docs.bigmodel.cn/
- **定价信息**: https://open.bigmodel.cn/pricing
- **技术支持**: 访问智谱AI开发者社区

## 🆘 技术支持

遇到问题？

1. 查看本文档的故障排查部分
2. 运行测试脚本诊断：`python3 test_glm_integration.py`
3. 查看项目根目录的`CLAUDE.md`了解技术细节
4. 访问智谱AI官方文档获取最新信息

---

**最后更新**: 2025年1月
**版本**: V1.0
**状态**: ✅ 稳定可用
